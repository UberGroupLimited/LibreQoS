<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LibreQoS Integrations &mdash; LibreQoE  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            LibreQoE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Readme:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Sponsors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#support-libreqos">Support LibreQoS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#matrix-chat">Matrix Chat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#features">Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Read me first!</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/Quickstart/networkdesignassumptions.html">Network Design Assumptions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Change Notes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/ChangeNotes/v1.4.html">LibreQoS v1.3.1 to v1.4 Change Summary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quickstart:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/SystemRequirements/Compute.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/SystemRequirements/Networking.html">Network Interface Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/Quickstart/quickstart-prereq.html">Server Setup - Pre-requisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/Quickstart/quickstart-libreqos-1.4.html">Install LibreQoS 1.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/Quickstart/share.html">Share your before and after</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Updates:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/Updates/update.html">Updating 1.4 To Latest Version</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/TechnicalDocs/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/TechnicalDocs/integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/TechnicalDocs/extras.html">Extras</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/TechnicalDocs/performance-tuning.html">Performance Tuning</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Legacy:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/Legacy/v1.3.1.html">LibreQoS v1.3.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LibreQoE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">LibreQoS Integrations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/src/INTEGRATION_HOWTO.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="libreqos-integrations">
<h1>LibreQoS Integrations<a class="headerlink" href="#libreqos-integrations" title="Permalink to this heading"></a></h1>
<p>If you need to create an integration for your network, we’ve tried to give you the tools you need. We currently ship integrations for UISP and Spylnx. We’d love to include more.</p>
<section id="overall-concept">
<h2>Overall Concept<a class="headerlink" href="#overall-concept" title="Permalink to this heading"></a></h2>
<p>LibreQoS enforces customer bandwidth limits, and applies CAKE-based optimizations at several levels:</p>
<ul class="simple">
<li><p>Per-user Cake flows are created. These require the maximum bandwidth permitted per customer.</p>
<ul>
<li><p>Customers can have more than one device that share a pool of bandwidth. Customers are grouped into “circuits”</p></li>
</ul>
</li>
<li><p><em>Optional</em> Access points can have a speed limit/queue, applied to all customers associated with the access point.</p></li>
<li><p><em>Optional</em> Sites can contain access points, and apply a speed limit/queue to all access points (and associated circuits).</p></li>
<li><p><em>Optional</em> Sites can be nested beneath other sites and access point, providing for a queue hierarchy that represents physical limitations of backhaul connections.</p></li>
</ul>
<p>Additionally, you might grow to have more than one shaper - and need to express your network topology from the perspective of different parts of your network. (For example, if <em>Site A</em> and <em>Site B</em> both have Internet connections - you want to generate an efficient topology for both sites. It’s helpful if you can derive this from the same overall topology)</p>
<p>LibreQoS’s network modeling accomplishes this by modeling your network as a <em>graph</em>: a series of interconnected nodes, each featuring a “parent”. Any “node” (entry) in the graph can be turned into a “root” node, allowing you to generate the <code class="docutils literal notranslate"><span class="pre">network.json</span></code> and <code class="docutils literal notranslate"><span class="pre">ShapedDevices.csv</span></code> files required to manage your customers from the perspective of that root node.</p>
</section>
<section id="flat-shaping">
<h2>Flat Shaping<a class="headerlink" href="#flat-shaping" title="Permalink to this heading"></a></h2>
<p>The simplest form of integration produces a “flat” network. This is the highest performance model in terms of raw throughput, but lacks the ability to provide shaping at the access point or site level: every customer site is parented directly off the root.</p>
<blockquote>
<div><p>For an integration, it’s recommended that you fetch the customer/device data from your management system rather than type them all in Python.</p>
</div></blockquote>
<p>A flat integration is relatively simple. Start by importing the common API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">integrationCommon</span> <span class="kn">import</span> <span class="n">isIpv4Permitted</span><span class="p">,</span> <span class="n">fixSubnet</span><span class="p">,</span> <span class="n">NetworkGraph</span><span class="p">,</span> <span class="n">NetworkNode</span><span class="p">,</span> <span class="n">NodeType</span>
</pre></div>
</div>
<p>Then create an empty network graph (it will grow to represent your network):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="o">=</span> <span class="n">NetworkGraph</span><span class="p">()</span>
</pre></div>
</div>
<p>Once you have your <code class="docutils literal notranslate"><span class="pre">NetworkGraph</span></code> object, you start adding customers and devices. Customers may have any number of devices. You can add a single customer with one device as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the customer</span>
<span class="n">customer</span> <span class="o">=</span> <span class="n">NetworkNode</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Unique Customer ID&quot;</span><span class="p">,</span>
    <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;The Doe Family&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">client</span><span class="p">,</span>
    <span class="n">download</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c1"># Download is in Mbit/second</span>
    <span class="n">upload</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="c1"># Upload is in Mbit/second</span>
    <span class="n">address</span><span class="o">=</span><span class="s2">&quot;1 My Road, My City, My State&quot;</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span> <span class="c1"># Insert the customer ID</span>

<span class="c1"># Give them a device</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">NetworkNode</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Unique Device ID&quot;</span><span class="p">,</span> 
    <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;Doe Family CPE&quot;</span><span class="p">,</span>
    <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;Unique Customer ID&quot;</span><span class="p">,</span> <span class="c1"># must match the customer&#39;s ID</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> 
    <span class="n">ipv4</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;100.64.1.5/32&quot;</span><span class="p">],</span> <span class="c1"># As many as you need, express networks as the network ID - e.g. 192.168.100.0/24</span>
    <span class="n">ipv6</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feed:beef::12/64&quot;</span><span class="p">],</span> <span class="c1"># Same again. May be [] for none.</span>
    <span class="n">mac</span><span class="o">=</span><span class="s2">&quot;00:00:5e:00:53:af&quot;</span>
<span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
<p>If the customer has multiple devices, you can add as many as you want - with <code class="docutils literal notranslate"><span class="pre">ParentId</span></code> continuing to match the parent customer’s <code class="docutils literal notranslate"><span class="pre">id</span></code>.</p>
<p>Once you have entered all of your customers, you can finish the integration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">prepareTree</span><span class="p">()</span> <span class="c1"># This is required, and builds parent-child relationships.</span>
<span class="n">net</span><span class="o">.</span><span class="n">createNetworkJson</span><span class="p">()</span> <span class="c1"># Create `network.json`</span>
<span class="n">net</span><span class="o">.</span><span class="n">createShapedDevices</span><span class="p">()</span> <span class="c1"># Create the `ShapedDevices.csv` file.</span>
</pre></div>
</div>
</section>
<section id="detailed-hierarchies">
<h2>Detailed Hierarchies<a class="headerlink" href="#detailed-hierarchies" title="Permalink to this heading"></a></h2>
<p>Creating a full hierarchy (with as many levels as you want) uses a similar strategy to flat networks—we recommend that you start by reading the “flat shaping” section above.</p>
<p>Start by importing the common API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">integrationCommon</span> <span class="kn">import</span> <span class="n">isIpv4Permitted</span><span class="p">,</span> <span class="n">fixSubnet</span><span class="p">,</span> <span class="n">NetworkGraph</span><span class="p">,</span> <span class="n">NetworkNode</span><span class="p">,</span> <span class="n">NodeType</span>
</pre></div>
</div>
<p>Then create an empty network graph (it will grow to represent your network):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="o">=</span> <span class="n">NetworkGraph</span><span class="p">()</span>
</pre></div>
</div>
<p>Now you can start to insert sites and access points. Sites and access points are inserted like customer or device nodes: they have a unique ID, and a <code class="docutils literal notranslate"><span class="pre">ParentId</span></code>. Customers can then use a <code class="docutils literal notranslate"><span class="pre">ParentId</span></code> of the site or access point beneath which they should be located.</p>
<p>For example, let’s create <code class="docutils literal notranslate"><span class="pre">Site_1</span></code> and <code class="docutils literal notranslate"><span class="pre">Site_2</span></code> - at the top of the tree:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Site_1&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;Site_1&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">site</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Site_2&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;Site_2&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">site</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
</pre></div>
</div>
<p>Let’s attach some access points and point-of-presence sites:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;AP_A&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;AP_A&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;Site_1&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">ap</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Site_3&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;Site_3&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;Site_1&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">site</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;PoP_5&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;PoP_5&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;Site_3&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">site</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">200</span><span class="p">))</span>        
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;AP_9&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;AP_9&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;PoP_5&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">ap</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">120</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;PoP_6&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;PoP_6&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;PoP_5&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">site</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;AP_11&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;AP_11&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;PoP_6&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">ap</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;PoP_1&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;PoP_1&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;Site_2&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">site</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">200</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;AP_7&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;AP_7&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;PoP_1&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">ap</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">NetworkNode</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;AP_1&quot;</span><span class="p">,</span> <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;AP_1&quot;</span><span class="p">,</span> <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;Site_2&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">ap</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">upload</span><span class="o">=</span><span class="mi">150</span><span class="p">))</span>
</pre></div>
</div>
<p>When you attach a customer, you can specify a tree entry (e.g. <code class="docutils literal notranslate"><span class="pre">PoP_5</span></code>) as a parent:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the customer</span>
<span class="n">customer</span> <span class="o">=</span> <span class="n">NetworkNode</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Unique Customer ID&quot;</span><span class="p">,</span>
    <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;The Doe Family&quot;</span><span class="p">,</span>
    <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;PoP_5&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">client</span><span class="p">,</span>
    <span class="n">download</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c1"># Download is in Mbit/second</span>
    <span class="n">upload</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="c1"># Upload is in Mbit/second</span>
    <span class="n">address</span><span class="o">=</span><span class="s2">&quot;1 My Road, My City, My State&quot;</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span> <span class="c1"># Insert the customer ID</span>

<span class="c1"># Give them a device</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">NetworkNode</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Unique Device ID&quot;</span><span class="p">,</span> 
    <span class="n">displayName</span><span class="o">=</span><span class="s2">&quot;Doe Family CPE&quot;</span><span class="p">,</span>
    <span class="n">parentId</span><span class="o">=</span><span class="s2">&quot;Unique Customer ID&quot;</span><span class="p">,</span> <span class="c1"># must match the customer&#39;s ID</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">NodeType</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> 
    <span class="n">ipv4</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;100.64.1.5/32&quot;</span><span class="p">],</span> <span class="c1"># As many as you need, express networks as the network ID - e.g. 192.168.100.0/24</span>
    <span class="n">ipv6</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feed:beef::12/64&quot;</span><span class="p">],</span> <span class="c1"># Same again. May be [] for none.</span>
    <span class="n">mac</span><span class="o">=</span><span class="s2">&quot;00:00:5e:00:53:af&quot;</span>
<span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">addRawNode</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
<p>Once you have entered all of your network topology and customers, you can finish the integration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">net</span><span class="o">.</span><span class="n">prepareTree</span><span class="p">()</span> <span class="c1"># This is required, and builds parent-child relationships.</span>
<span class="n">net</span><span class="o">.</span><span class="n">createNetworkJson</span><span class="p">()</span> <span class="c1"># Create `network.json`</span>
<span class="n">net</span><span class="o">.</span><span class="n">createShapedDevices</span><span class="p">()</span> <span class="c1"># Create the `ShapedDevices.csv` file.</span>
</pre></div>
</div>
<p>You can also add a call to <code class="docutils literal notranslate"><span class="pre">net.plotNetworkGraph(False)</span></code> (use <code class="docutils literal notranslate"><span class="pre">True</span></code> to also include every customer; this can make for a HUGE file) to create a PDF file (currently named <code class="docutils literal notranslate"><span class="pre">network.pdf.pdf</span></code>) displaying your topology. The example shown here looks like this:</p>
<p><img alt="" src="../_images/sample_layout1.png" /></p>
</section>
<section id="longest-prefix-match-tip">
<h2>Longest Prefix Match Tip<a class="headerlink" href="#longest-prefix-match-tip" title="Permalink to this heading"></a></h2>
<p>You could theoretically throttle all unknown IPs until they are associated with a client. For example, you could limit every unknown to 1.5x0.5 with single entry in ShapedDevices.csv, until you associate them with an account. IPs need to be non-exact matches. So you can’t have two 192.168.1.1 entries, but you can have a 192.168.1.0/24 subnet and a 192.168.1.2/32 - they aren’t duplicates, and the LPM search is smart enough to pick the most exact match.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, LibreQoE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>